const AmazonCognitoIdentity = require('amazon-cognito-identity-js');

exports.handler = async function auth(event) {
    try{
        console.log('Event', event)
        //const body = JSON.parse(event)
        // username & password
        var authenticationData = {
            Username : event.username,
            Password : event.password,
        };
        var authenticationDetails = new AmazonCognitoIdentity.AuthenticationDetails(authenticationData);
        // Cognito User Pool ID and App Cliend ID
        var poolData = { UserPoolId : event.userpoolid,
            ClientId : event.clientid
        };
        var userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);
        var userData = {
            Username : event.username,
            Pool : userPool
        };
        var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);
    } catch(err){
        console.log(err);
        return err;
    }
    //return User ID Token
    return new Promise( (success, error) => {
        cognitoUser.authenticateUser(authenticationDetails, {
        onSuccess: (result) => {
            success(result.idToken.jwtToken);
        },
        onFailure: (err) => {
            console.error(err);
            error(err);
        },
    })
    });

}